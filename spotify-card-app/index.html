<!doctype html>
<html>
  <body style="font-family: sans-serif; padding: 24px;">
    <h2>Spotify Endpoint Test</h2>

    <input id="url" style="width: 520px;" placeholder="Paste Spotify track link" />
    <button onclick="run()">Test</button>

    <pre id="out" style="white-space: pre-wrap; margin-top: 16px; background:#f5f5f5; padding:12px;"></pre>

    <script>
      async function run() {
        const url = document.getElementById("url").value.trim();
        const out = document.getElementById("out");
        out.textContent = "Resolving...\n";

        const r1 = await fetch(`/api/resolve?url=${encodeURIComponent(url)}`);
        const j1 = await r1.json();
        out.textContent += JSON.stringify(j1, null, 2) + "\n\n";

        if (!j1.id || j1.type !== "track") {
          out.textContent += "Please paste a TRACK link for this test.\n";
          return;
        }

        out.textContent += "Fetching track...\n";
        const r2 = await fetch(`/api/track?id=${encodeURIComponent(j1.id)}`);
        const j2 = await r2.json();
        out.textContent += JSON.stringify(j2, null, 2);
      }
    </script>
  </body>
</html>
